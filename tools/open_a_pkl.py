import pickle
if __name__ == '__main__':
    a = [1, 2, 3]
    # 以二进制的形式打开文件
    # with open("data/nuscenes/v1.0-mini/nuscenes_infos_10sweeps_val.pkl", "wb") as f:
    #     # 将列表a序列化后写入文件
    #     pickle.dump(a, f)
    # with open("/home/xingchen/Study/pytorch/SurroundOcc/data/nuscenes/nuscenes_infos_val.pkl", 'rb') as f:
    with open("/home/xingchen/Study/pytorch/SurroundOcc/data/nuscenes/nuscenes_infos_train.pkl", 'rb') as f:
        
        # 反序列化解析成列表a
        a = pickle.load(f)
        # gt_boxes,gt_labels = [],[]
        # name_label = {'car':0,'pedestrian':1}
        # for i in a:
        #     if i['lidar_path'] == 'samples/LIDAR_TOP/n008-2018-08-01-15-16-36-0400__LIDAR_TOP__1533151603547590.pcd.bin':
        #         for j in range(len(i['gt_boxes'])):
        #             gt_box = i['gt_boxes'][j]
        #             gt_label = name_label[i['gt_names'][j]]
        #             gt_boxes.append(gt_box)
        #             gt_labels.append(gt_label)
        #         print(gt_labels)
        #         break


    print(a[0], a.__class__)  # [1, 2, 3] <class 'list'>

'''
一、打开nuscenes_infos_val.pkl
nuScenes val就是test，包含150个场景，每个场景约20s，每0.5s一帧关键帧，关键帧合计约40*150=6000帧
nuscenes_infos_val.pkl中包含6019帧，每一帧含23项，第一帧为
{
    'lidar_path': './data/nuscenes/samp...96.pcd.bin',  # lidar数据的路径
    'token': 'fd8420396768425eabec9bdddf7e64b6',        # sample_token 这一帧的token
    'prev': '', 
    'next': '6eb8a3ff0abf4f3a9380...8f2a0b87ef', 
    'can_bus': array([ 2.49895286e+...0000e+00]),       # 
    'frame_idx': 0,                                     # 关键帧序号
    'sweeps': [],                                       # 前后10帧的data 第一帧和最后一帧为空
    'cams': {                                           # 相机data
        'CAM_FRONT': 
            {
            'data_path': './data/nuscenes/samp...412460.jpg', 
            'type': 'CAM_FRONT', 
            'sample_data_token': 'b8fba7d78cf547b996c4...dec1f5ee26', 
            'sensor2ego_translation': [1.70079118954, 0.0159456324149, 1.51095763913], 
            'sensor2ego_rotation': [0.4998015430569128, -0.5030316162024876, 0.4997798114386805, -0.49737083824542755], 
            'ego2global_translation': [249.90018228466124, 917.5514452794962, 0.0], 
            'ego2global_rotation': [0.9984397071954904, -0.008652973321832425, 0.002523596051210081, -0.05510815376190409], 
            'timestamp': 1533201470412460, 
            'sensor2lidar_rotation': array([[ 0.99996937,...1869004]]), 
            'sensor2lidar_translation': array([-0.01271581, ...31059456]), 
            'cam_intrinsic': array([[1.26641720e+...000e+00]])
            }, 
        'CAM_FRONT_RIGHT': {...}, 
        'CAM_FRONT_LEFT': {...}, 
        'CAM_BACK': {...}, 
        'CAM_BACK_LEFT': {...}, 
        'CAM_BACK_RIGHT': {...}
            }, 
            
    'scene_token': 'e7ef871f77f44331aefd...c24ec034b7', 
    'lidar2ego_translation': [0.943713, 0.0, 1.84023], 
    'lidar2ego_rotation': [0.7077955119163518, -0.006492242056004365, 0.010646214713995808, -0.7063073142877817], 
    'ego2global_translation': [249.89610931430778, 917.5522573162784, 0.0], 
    'ego2global_rotation': [0.9984303573176436, -0.008635865272570774, 0.0025833156025800875, -0.05527720957189669], 
    'timestamp': 1533201470448696, 
    
    'gt_boxes': array([[-7.29056168e+00, -8.70706277e+00, -1.09857236e+00,         1.72600000e+00,  4.25700000e+00,  1.48900000e+00,        -1.91416308e+00],       [-1.66302828e+01, -8.42165938e+00, -7.82945643e-01,         1.71000000e+00,  4.24800000e+00,  1.52700000e+00,         1.56195684e+00],       [-1.89306947e+00, -5.67105589e+00, -1.33461907e+00,         1.77100000e+00,  4.30300000e+00,  1.40700000e+00,        -2.63878887e+00],       [-1.02414117e+01, -3.07503509e+01, -1.36545791e+00,         1.73200000e+00,  4.50200000e+00,  1.79900000e+00,         1.54813383e+00],       [-2.27759381e+01,  3.89957047e+01,  8.86592602e-01,         6.95000000e-01,  1.09500000e+00,  1.78000000e+00,        -1.28008496e+00],       [-2.21674250e+01, -2.93588303e+01, -1.02649023e+00,         1.73200000e+00,  4.25300000e+00,  1.49100000e+00,        -1.56424201e+00],       [ 9.65525350e+00, -1.68588737e+01, -1.45123423e+00,         6.47000000e-01,  9.08000000e-01,  1.76000000e+00,        -3.38322416e+00],       [-2.17985249e+01,  3.86445196e+01,  9.04663748e-01,         5.09000000e-01,  1.02100000e+00,  1.75800000e+00,        -1.14045862e+00],       [-5.31021172e+00, -3.28709687e+01, -1.61392449e+00,         1.72100000e+00,  4.59700000e+00,  1.48600000e+00,         1.49566923e+00],       [-5.27380902e+01,  1.45850782e+00,  1.83948171e+00,         7.03000000e-01,  7.14000000e-01,  1.79400000e+00,        -1.61277962e+00],       [ 2.40698125e+01, -1.29183717e+01, -1.03262081e+00,         7.14000000e-01,  8.92000000e-01,  1.79400000e+00,        -3.77072056e+00],       [ 6.38584123e+00,  1.26742765e+01, -1.24666092e+00,         2.26000000e-01,  2.43000000e-01,  7.36000000e-01,        -4.64378821e+00],       [ 6.05383397e+00,  1.26409025e+01, -1.20378486e+00,         2.25000000e-01,  2.63000000e-01,  8.06000000e-01,        -4.64378821e+00],       [-2.20000938e+01, -3.18759650e+01, -1.05857449e+00,         1.86400000e+00,  4.24800000e+00,  1.52100000e+00,        -1.56424201e+00],       [-2.18509813e+01, -3.41900960e+01, -1.14881893e+00,         1.86800000e+00,  4.19200000e+00,  1.42500000e+00,        -1.59345883e+00],       [-2.23857498e+01, -3.96578463e+01, -1.24916979e+00,         1.64700000e+00,  4.27600000e+00,  1.60300000e+00,         1.54813383e+00],       [-2.07611389e+01, -1.90158777e+01, -9.96223109e-01,         1.97900000e+00,  4.17500000e+00,  1.30600000e+00,        -1.63477077e+00],       [ 1.26403144e+00, -5.70577633e+01, -2.18233638e+00,         1.78500000e+00,  4.60600000e+00,  1.60400000e+00,        -3.74312940e-03],       [-1.14203818e+01, -4.10617442e+01, -1.46747066e+00,         1.70300000e+00,  4.33800000e+00,  1.51900000e+00,         1.54813383e+00],       [-1.02507459e+01, -2.74995361e+01, -1.23868262e+00,         1.79200000e+00,  4.32800000e+00,  1.64400000e+00,         1.52591579e+00],       [ 4.51359897e+00,  2.31183170e+01, -4.53835507e-01,         6.82000000e-01,  8.91000000e-01,  1.72100000e+00,        -2.97416306e-01],       [-9.21473845e-02,  6.63452888e+00, -9.50987593e-01,         1.66400000e+00,  4.05200000e+00,  1.39600000e+00,        -3.14807595e+00],       [-2.28021101e+01, -2.68637331e+01, -8.58628016e-01,         1.73400000e+00,  4.25700000e+00,  1.43400000e+00,        -4.66499396e+00],       [-2.22876885e+01, -2.39858155e+01, -9.85335566e-01,         1.69600000e+00,  4.30300000e+00,  1.53100000e+00,        -4.67197528e+00],       [-1.73005682e+01, -1.14016516e+01, -6.88320040e-01,         1.68300000e+00,  4.62200000e+00,  1.86600000e+00,         1.56195684e+00],       [-1.05645641e+01, -3.35523405e+01, -1.41689640e+00,         1.72600000e+00,  4.29100000e+00,  1.58700000e+00,         1.54813383e+00],       [-3.54797258e-02,  1.16452534e+01, -8.55924814e-01,         1.73100000e+00,  4.42100000e+00,  1.41000000e+00,        -3.14210692e+00],       [-2.26331089e+01,  3.79646805e+01,  8.89226528e-01,         6.47000000e-01,  7.23000000e-01,  1.83500000e+00,        -4.41719687e+00],       [ 5.73727627e+00,  4.72076650e+01,  1.39929042e-01,         2.15200000e+00,  4.74400000e+00,  2.04000000e+00,        -1.26263167e+00],       [-1.07302280e+01, -2.46940096e+01, -1.21300242e+00,         1.69700000e+00,  4.25900000e+00,  1.59900000e+00,         1.53268675e+00],       [-5.65209197e+00, -4.12776732e+01, -1.57833244e+00,         1.73700000e+00,  4.48800000e+00,  1.63900000e+00,         1.50996348e+00],       [-2.65141680e+01, -4.58901922e+00,  4.56180296e-01,         4.48000000e-01,  4.64000000e-01,  9.76000000e-01,        -1.61277962e+00],       [-5.22986939e+00, -2.72206980e+01, -1.54231604e+00,         1.83500000e+00,  4.35500000e+00,  1.51600000e+00,         1.51312252e+00],       [-2.63301890e+01, -2.25380263e+01,  3.73744315e-01,         4.60000000e-01,  7.34000000e-01,  1.73900000e+00,        -3.89563937e-02],       [-2.95415615e+01, -6.39003052e+00,  9.22721883e-01,         8.19000000e-01,  8.15000000e-01,  1.90400000e+00,        -1.56041974e+00],       [ 5.14031875e+00, -1.17934889e+01, -1.34049731e+00,         1.69000000e+00,  4.54400000e+00,  1.51000000e+00,         5.20459191e-03],       [ 9.15591698e+00,  1.57006054e+01, -6.36625418e-01,         7.03000000e-01,  8.43000000e-01,  1.86200000e+00,         7.07356368e-01],       [-2.05570253e+01, -5.80944222e+00, -6.61290823e-01,         1.71400000e+00,  4.32600000e+00,  1.43500000e+00,        -1.59900897e+00]]),
    'gt_names': array(['car', 'car', 'car', 'car', 'pedestrian', 'car', 'pedestrian',       'pedestrian', 'car', 'pedestrian', 'pedestrian', 'traffic_cone',       'traffic_cone', 'car', 'car', 'car', 'car', 'car', 'car', 'car',       'pedestrian', 'car', 'car', 'car', 'car', 'car', 'car',       'pedestrian', 'car', 'car', 'car', 'traffic_cone', 'car',       'pedestrian', 'pedestrian', 'car', 'pedestrian', 'car'],      dtype='<U12'),
    'gt_velocity': array([[ 5.08512606e-01,  1.73870736e-01],       [ 0.00000000e+00,  0.00000000e+00],       [-1.41333495e-02, -2.67655960e-02],       [-1.17649963e-01, -2.11593868e-03],       [ 1.59911924e+00, -5.68002020e-01],       [-1.56715314e-01,  4.08418045e-02],       [-3.10077972e-01,  1.20410452e+00],       [ 1.63412539e+00, -7.99764681e-01],       [-4.68804933e-02, -4.25078319e-03],       [ 1.57923994e+00,  1.31798877e-01],       [-7.33785961e-01,  8.93694011e-01],       [ 3.93222442e-02, -9.02681472e-02],       [-2.42863443e-02, -5.30847652e-02],       [-1.29041243e-01,  6.35312881e-04],       [-2.47521939e-02, -2.19132752e-02],       [-8.93147824e-02, -3.92266297e-02],       [ 0.00000000e+00,  0.00000000e+00],       [-2.01758059e-01, -5.61570677e+00],       [-2.16025021e-01, -5.04164856e-02],       [-1.43333856e-01,  3.83137663e-02],       [ 3.69071304e-01, -1.28108228e+00],       [-3.09817155e-03,  4.41820944e-01],       [ 1.74698032e-03,  2.94052409e-02],       [-8.60297781e-02,  3.44493802e-03],       [-5.77175926e-04,  3.21662214e-02],       [-1.37663062e-01, -3.35334121e-03],       [ 6.69020049e-05,  3.50519150e-01],       [-1.09859140e+00,  4.80107904e-01],       [ 1.85864019e-01, -1.30236556e-01],       [-2.42229549e-02,  9.36982158e-03],       [-8.07066596e-02, -1.71095990e-02],       [-2.50433278e-02,  7.07180704e-02],       [-1.33975598e-01, -5.43078504e-02],       [-6.02673970e-02, -1.01901290e+00],       [ 1.07621148e+00,  1.69618367e-02],       [-5.28304809e-02, -3.21129882e-02],       [-8.34458314e-01, -9.43682252e-01],       [-1.59280896e-03,  5.92471796e-02]]),
    'num_lidar_pts': array([184,  30, 466,   6,   1,   6,   2,   0,   3,   2,   6,   2,   0,         3,   2,   0,   7,   5,   2,   8,   0, 477,   2,  11,  51,   5,        18,   2,   5,  21,   1,   2,   8,   1,   4, 113,  10,  47]),
    'num_radar_pts': array([5, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 4,       0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 4, 1, 0]),
    
    'valid_flag': array([ True,  True,  True,  True,  True,  True,  True, False,  True,        True,  True,  True, False,  True,  True, False,  True,  True,        True,  True, False,  True,  True,  True,  True,  True,  True,        True,  True,  True,  True,  True,  True,  True,  True,  True,        True,  True]),
    'lidar_token': '5f6c1e0a0c3b444b97e78d2aa3fa34d2',
    'lidar_seg': '5f6c1e0a0c3b444b97e78d2aa3fa34d2_lidarseg.bin',
    'occ_path': './data/nuscenes_occ/samples/n015-2018-08-02-17-16-37+0800__LIDAR_TOP__1533201470948018.pcd.bin.npy'
}

二、打开nuscenes_infos_train.pkl
nuScenes train包含700个场景，每个场景约20s，每0.5s一帧关键帧，关键帧合计约40*700=28000帧
nuscenes_infos_train.pkl中包含28130帧，每一帧含23项，格式与val内相同，第一帧为
{
    'lidar_path': './data/nuscenes/samp...77.pcd.bin', 
    'token': 'e93e98b63d3b40209056...29dc53ceee', 
    'prev': '', 
    'next': '14d5adfe50bb4445bc3a...fe607691a8', 
    'can_bus': array([ 1.01014362e+...0000e+00]), 
    'frame_idx': 0, 
    'sweeps': [], 
    'cams': {
        'CAM_FRONT': {...}, 
        'CAM_FRONT_RIGHT': {...}, 
        'CAM_FRONT_LEFT': {...}, 
        'CAM_BACK': {...}, 
        'CAM_BACK_LEFT': {...}, 
        'CAM_BACK_RIGHT': {...}
            }, 
    'scene_token': '73030fb67d3c46cfb5e5...168088ae39', 
    'lidar2ego_translation': [0.943713, 0.0, 1.84023], 
    'lidar2ego_rotation': [0.7077955119163518, -0.006492242056004365, 0.010646214713995808, -0.7063073142877817], 
    'ego2global_translation': [1010.1328353833223, 610.8111652918716, 0.0], 
    'ego2global_rotation': [-0.7495886280607293, -0.0077695335695504636, 0.00829759813869316, -0.6618063711504101], 
    'timestamp': 1531883530449377, 
    'gt_boxes': ...,
    'gt_names': ...,
    'num_lidar_pts': ...,
    'num_radar_pts': ...,
    'lidar_token': ...,
    'lidar_seg': ...,
    'occ_path': ...
}
'''